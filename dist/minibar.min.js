/*!
 * MiniBar 0.3.1
 * http://mobius.ovh/
 *
 * Released under the MIT license
 */
(function(g){"use strict";var h=window,j=document,k=j.body,l={x:"left",y:"top"},p={x:"width",y:"height"},q={x:"scrollLeft",y:"scrollTop"},w={x:"scrollWidth",y:"scrollHeight"},x={x:"pageX",y:"pageY"},y={barType:"default",minBarSize:10,alwaysShowBars:!1,horizontalMouseScroll:!1,scrollX:!0,scrollY:!0,navButtons:!1,scrollAmount:10,mutationObserver:{attributes:!1,childList:!0,subtree:!0},classes:{container:"mb-container",content:"mb-content",track:"mb-track",bar:"mb-bar",visible:"mb-visible",progress:"mb-progress",hover:"mb-hover",scrolling:"mb-scrolling",textarea:"mb-textarea",wrapper:"mb-wrapper",nav:"mb-nav",btn:"mb-button",btns:"mb-buttons",increase:"mb-increase",decrease:"mb-decrease"}},z=function(M){for(var Q,O=Object(M),P=1;P<arguments.length;P++)if(Q=arguments[P],null!=Q)for(var R in Q)Object.prototype.hasOwnProperty.call(Q,R)&&(O[R]=Q[R]);return O},A=function(M,N,O){M.addEventListener(N,O,!1)},B=function(M,N,O){M.removeEventListener(N,O)},C=function(M,N,O){if("[object Object]"===Object.prototype.toString.call(M))for(var P in M)Object.prototype.hasOwnProperty.call(M,P)&&N.call(O,P,M[P]);else for(var Q=0,R=M.length;Q<R;Q++)N.call(O,Q,M[Q])},D=function(M,N){var O=M&&M.style,P="[object Object]"===Object.prototype.toString.call(N);if(O){if(!N)return h.getComputedStyle(M);P&&C(N,function(Q,R){Q in O||(Q="-webkit-"+Q),O[Q]=R+("string"==typeof R?"":"opacity"===Q?"":"px")})}},E=function(M){var N=h,O=M.getBoundingClientRect(),P=j.documentElement||k.parentNode||k,Q=void 0===N.pageXOffset?P.scrollLeft:N.pageXOffset,R=void 0===N.pageYOffset?P.scrollTop:N.pageYOffset;return{x:O.left+Q,y:O.top+R,height:Math.round(O.height),width:Math.round(O.width)}},F=function(M,N,O){var P;return function(){var Q=this,R=arguments,S=O&&!P;clearTimeout(P),P=setTimeout(function(){P=null,O||M.apply(Q,R)},N),S&&M.apply(Q,R)}},G=h.requestAnimationFrame||function(){var M=0;return h.webkitRequestAnimationFrame||h.mozRequestAnimationFrame||function(N){var O,P=new Date().getTime();return O=Math.max(0,16-(P-M)),M=P+O,setTimeout(function(){N(P+O)},O)}}(),H=h.cancelAnimationFrame||function(M){clearTimeout(M)}(),I=function(){var M=0,N=j.createElement("div");return N.style.cssText="width: 100; height: 100; overflow: scroll; position: absolute; top: -9999;",j.body.appendChild(N),M=N.offsetWidth-N.clientWidth,j.body.removeChild(N),M},J={contains:function(M,N){if(M)return M.classList?M.classList.contains(N):!!M.className&&!!M.className.match(new RegExp("(\\s|^)"+N+"(\\s|$)"))},add:function(M,N){J.contains(M,N)||(M.classList?M.classList.add(N):M.className=M.className.trim()+" "+N)},remove:function(M,N){J.contains(M,N)&&(M.classList?M.classList.remove(N):M.className=M.className.replace(new RegExp("(^|\\s)"+N.split(" ").join("|")+"(\\s|$)","gi")," "))},toggle:function(M,N,O){var P=this.contains(M,N)?!0!==O&&"remove":!1!==O&&"add";P&&this[P](M,N)}},K=function(M,N){this.container="string"==typeof M?j.querySelector(M):M,this.config=y,N?this.config=z({},y,N):h.MiniBarOptions&&(this.config=z({},y,h.MiniBarOptions)),this.css=h.getComputedStyle(this.container),this.size=I(),this.textarea="textarea"===this.container.nodeName.toLowerCase(),this.bars={x:{},y:{}},this.tracks={x:{},y:{}},this.events={},C(["update","scroll","mouseenter","mousedown","mousemove","mouseup","wheel"],function(O,P){this.events[P]=this[P].bind(this)},this),this.events.debounce=F(this.events.update,50),this.init()},L=K.prototype;L.init=function(){var M=this,N=M.config,O=M.events;if(!M.initialised){if(M.textarea)M.content=M.container,M.container=j.createElement("div"),J.add(M.container,N.classes.textarea),M.wrapper=j.createElement("div"),J.add(M.wrapper,N.classes.wrapper),M.container.appendChild(M.wrapper),M.content.parentNode.insertBefore(M.container,M.content),M.content.addEventListener("input",function(){M.update()});else for(M.content=j.createElement("div");M.container.firstChild;)M.content.appendChild(M.container.firstChild);if(J.add(M.container,N.classes.container),J.add(M.content,N.classes.content),N.alwaysShowBars&&J.add(M.container,N.classes.visible),C(M.tracks,function(Q,R){if(M.bars[Q].node=j.createElement("div"),R.node=j.createElement("div"),J.add(R.node,N.classes.track),J.add(R.node,N.classes.track+"-"+Q),J.add(M.bars[Q].node,N.classes.bar),R.node.appendChild(M.bars[Q].node),N.navButtons){var S=j.createElement("button"),T=j.createElement("button"),U=j.createElement("div"),V=N.scrollAmount;S.className=N.classes.btn+" "+N.classes.decrease,T.className=N.classes.btn+" "+N.classes.increase,U.className=N.classes.btns+" "+N.classes.btns+"-"+Q,U.appendChild(S),U.appendChild(R.node),U.appendChild(T),M.container.appendChild(U),J.add(M.container,N.classes.nav),A(U,"mousedown",function(W){var X=W.target;if(H(M.frame),X===T||X===S){var Y=M.content[q[Q]],Z=function(){switch(M.content[q[Q]]=Y,X){case S:Y-=V;break;case T:Y+=V;}M.frame=G(Z)};Z()}}),A(U,"mouseup",function(W){var X=W.target,Y=5*V;H(M.frame),X!==T&&X!==S||M.scrollBy(X===S?-Y:Y,Q)})}else M.container.appendChild(R.node);"progress"===N.barType?(J.add(R.node,N.classes.progress),A(R.node,"mousedown",O.mousedown)):A(M.bars[Q].node,"mousedown",O.mousedown),A(R.node,"mouseenter",function(){J.add(M.container,N.classes.hover+"-"+Q)}),A(R.node,"mouseleave",function(){M.down||J.remove(M.container,N.classes.hover+"-"+Q)})}),M.textarea?M.wrapper.appendChild(M.content):M.container.appendChild(M.content),"static"===M.css.position&&(M.manualPosition=!0,M.container.style.position="relative"),M.update(),A(M.content,"scroll",O.scroll),A(M.container,"mouseenter",O.mouseenter),N.horizontalMouseScroll&&A(M.content,"wheel",O.wheel),A(h,"resize",O.debounce),A(j,"DOMContentLoaded",O.update),A(h,"load",O.update),"MutationObserver"in window){var M=this,P=function(Q){for(var S of Q)"childList"==S.type&&M.update()};this.observer=new MutationObserver(P),this.observer.observe(this.content,this.config.mutationObserver)}M.initialised=!0}},L.scroll=function(){this.updateBars()},L.scrollBy=function(M,N,O,P){if(N=N||"y",0===O)return void(this.content[q[N]]+=M);void 0===O&&(O=250),P=P||function(U,V,W,X){return U/=X,-W*U*(U-2)+V};var Q=this,R=Date.now(),S=Q.content[q[N]],T=function(){var U=Date.now(),V=U-R;return V>O?void H(Q.frame):void(Q.content[q[N]]=P(V,S,M,O),Q.frame=G(T))};T()},L.wheel=function(M){M.preventDefault(),this.scrollBy(100*M.deltaY,"x")},L.mouseenter=function(){this.updateBars()},L.mousedown=function(M){M.preventDefault();var N=this,O=N.config,P="progress"===O.barType?"tracks":"bars",Q=M.target===N[P].x.node?"x":"y";N.down=!0,N.currentAxis=Q,N.update(),J.add(N.container,O.classes.visible),J.add(N.container,O.classes.scrolling+"-"+Q),"progress"===O.barType?(N.origin={x:M.pageX-N.tracks[Q].x,y:M.pageY-N.tracks[Q].y},N.mousemove(M)):N.origin={x:M.pageX-N.bars[Q].x,y:M.pageY-N.bars[Q].y},A(j,"mousemove",N.events.mousemove),A(j,"mouseup",N.events.mouseup)},L.mousemove=function(M){M.preventDefault();var S,T,U,N=this,O=this.origin,P=this.currentAxis,Q=N.tracks[P],R=Q[p[P]],V="progress"===N.config.barType;S=V?M[x[P]]-Q[P]:M[x[P]]-O[P]-Q[P],T=S/R,U=V?T*(N.content[w[P]]-N.rect[p[P]]):T*N[w[P]],G(function(){N.content[q[P]]=U})},L.mouseup=function(M){var N=this,O=N.config,P=N.events;J.toggle(N.container,O.classes.visible,O.alwaysShowBars),J.remove(N.container,O.classes.scrolling+"-"+N.currentAxis),J.contains(M.target,O.classes.bar)||(J.remove(N.container,O.classes.hover+"-x"),J.remove(N.container,O.classes.hover+"-y")),N.currentAxis=null,N.down=!1,B(j,"mousemove",P.mousemove),B(j,"mouseup",P.mouseup)},L.update=function(){var M=this,N=M.config,O=M.content,P=M.size;M.rect=E(M.container),M.scrollTop=O.scrollTop,M.scrollLeft=O.scrollLeft,M.scrollHeight=O.scrollHeight,M.scrollWidth=O.scrollWidth;var Q=M.scrollWidth>M.rect.width&&!M.textarea,R=M.scrollHeight>M.rect.height;if(J.toggle(M.container,"mb-scroll-x",Q&&N.scrollX),J.toggle(M.container,"mb-scroll-y",R&&N.scrollY),D(O,{overflowX:Q?"auto":"",overflowY:R?"auto":"",marginBottom:Q?-P:"",paddingBottom:Q?P:"",marginRight:R?-P:"",paddingRight:R?P:""}),M.scrollX=Q,M.scrollY=R,C(M.tracks,function(T,U){z(U,E(U.node)),z(M.bars[T],E(M.bars[T].node))}),M.updateBars(),M.wrapperPadding=0,M.textarea){var S=D(M.wrapper);M.wrapperPadding=parseInt(S.paddingTop,10)+parseInt(S.paddingBottom,10),!M.down&&M.content.selectionStart>=M.content.value.length&&(M.content.scrollTop=M.scrollHeight+1e3)}},L.updateBar=function(M){var N=this,O={},P=p,Q=w,R=N.config,S=N.tracks[M][P[M]],T=N.rect[P[M]]-N.wrapperPadding,U=N.content[q[M]],V=S/N[Q[M]],W=U/(N[Q[M]]-T);"progress"===R.barType?O[P[M]]=Math.floor(S*W):(O[P[M]]=Math.max(Math.floor(V*T),R.minBarSize),O[l[M]]=Math.floor((S-O[P[M]])*W)),G(function(){D(N.bars[M].node,O)})},L.updateBars=function(){C(this.bars,function(M){this.updateBar(M)},this)},L.destroy=function(){var M=this,N=M.config,O=M.container;if(M.initialised){for(B(O,"mouseenter",M.events.mouseenter),B(h,"resize",M.events.debounce),J.remove(O,N.classes.visible),J.remove(O,N.classes.container),J.remove(O,N.classes.nav),C(M.tracks,function(P,Q){O.removeChild(N.navButtons?Q.node.parentNode:Q.node),J.remove(O,"mb-scroll-"+P)});M.content.firstChild;)O.appendChild(M.content.firstChild);O.removeChild(M.content),M.manualPosition&&(O.style.position=""),M.bars={x:{},y:{}},M.tracks={x:{},y:{}},M.content=null,M.initialised=!1}},g.MiniBar=K})(this);